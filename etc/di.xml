<?xml version="1.0"?>
<!--
/**
* Shop System Plugins - Terms of Use
*
* The plugins offered are provided free of charge by Wirecard Central Eastern Europe GmbH
* (abbreviated to Wirecard CEE) and are explicitly not part of the Wirecard CEE range of
* products and services.
*
* They have been tested and approved for full functionality in the standard configuration
* (status on delivery) of the corresponding shop system. They are under General Public
* License Version 2 (GPLv2) and can be used, developed and passed on to third parties under
* the same terms.
*
* However, Wirecard CEE does not provide any guarantee or accept any liability for any errors
* occurring when used in an enhanced, customized shop system configuration.
*
* Operation in an enhanced, customized configuration is at your own risk and requires a
* comprehensive test phase by the user of the plugin.
*
* Customers use the plugins at their own risk. Wirecard CEE does not guarantee their full
* functionality neither does Wirecard CEE assume liability for any disadvantages related to
* the use of the plugins. Additionally, Wirecard CEE does not guarantee the full functionality
* for customized shop systems or installed plugins of other vendors of plugins within the same
* shop system.
*
* Customers are responsible for testing the plugin's functionality before starting productive
* operation.
*
* By installing the plugin into the shop system the customer agrees to these terms of use.
* Please do not use the plugin if you do not agree to these terms of use!
*/
-->

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <virtualType name="PaypalFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Wirecard\ElasticEngine\Model\Ui\ConfigProvider::PAYPAL_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\ConfigurableInfo</argument>
            <argument name="valueHandlerPool" xsi:type="object">PaypalValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">PaypalValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">PaypalCommandPool</argument>
        </arguments>
    </virtualType>
    <virtualType name="CreditCardFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Wirecard\ElasticEngine\Model\Ui\ConfigProvider::CREDITCARD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\ConfigurableInfo</argument>
            <argument name="valueHandlerPool" xsi:type="object">CreditCardValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">CreditCardValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">CreditCardCommandPool</argument>
        </arguments>
    </virtualType>
    <virtualType name="MaestroFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Wirecard\ElasticEngine\Model\Ui\ConfigProvider::MAESTRO_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\ConfigurableInfo</argument>
            <argument name="valueHandlerPool" xsi:type="object">MaestroValueHandlerPool</argument>
            <!--  We can use the same validators as for credit card. -->
            <argument name="validatorPool" xsi:type="object">CreditCardValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">MaestroCommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Value handlers -->
    <virtualType name="PaypalValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">PaypalConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="PaypalConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">WirecardPaypalConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="CreditCardValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">CreditCardConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="CreditCardConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">WirecardCreditCardConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="MaestroValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">MaestroConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="MaestroConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">WirecardMaestroConfig</argument>
        </arguments>
    </virtualType>

    <!-- Configs -->
    <virtualType name="WirecardElasticEngineConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="string">wirecard_elasticengine</argument>
            <argument name="pathPattern" xsi:type="string">%s/%s</argument>
        </arguments>
    </virtualType>
    <virtualType name="WirecardPaypalConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Wirecard\ElasticEngine\Model\Ui\ConfigProvider::PAYPAL_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="WirecardCreditCardConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Wirecard\ElasticEngine\Model\Ui\ConfigProvider::CREDITCARD_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="WirecardMaestroConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Wirecard\ElasticEngine\Model\Ui\ConfigProvider::MAESTRO_CODE</argument>
        </arguments>
    </virtualType>

    <!-- Validator -->
    <virtualType name="PaypalValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">PaypalCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="PaypalCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Magento\Payment\Gateway\Config\Config</argument>
        </arguments>
    </virtualType>

    <virtualType name="CreditCardValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
            </argument>
        </arguments>
    </virtualType>

    <!-- Commands -->
    <virtualType name="PaypalCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="initialize" xsi:type="string">PaypalInitializeCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="PaypalInitializeCommand" type="Wirecard\ElasticEngine\Gateway\Command\WirecardCommand">
        <arguments>
            <argument name="transactionFactory" xsi:type="object">PayPalTransactionFactory</argument>
            <argument name="transactionServiceFactory" xsi:type="object">TransactionServiceFactory</argument>
            <argument name="handler" xsi:type="object">Wirecard\ElasticEngine\Gateway\Response\ResponseHandler</argument>
            <argument name="methodConfig" xsi:type="object">WirecardPaypalConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="CreditCardCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="initialize" xsi:type="string">CreditCardInitializeCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="CreditCardInitializeCommand" type="Wirecard\ElasticEngine\Gateway\Command\WirecardCommand">
        <arguments>
            <argument name="transactionFactory" xsi:type="object">CreditCardTransactionFactory</argument>
            <argument name="transactionServiceFactory" xsi:type="object">TransactionServiceFactory</argument>
            <argument name="handler" xsi:type="object">Wirecard\ElasticEngine\Gateway\Response\ResponseHandler</argument>
            <argument name="methodConfig" xsi:type="object">WirecardCreditCardConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="MaestroCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="initialize" xsi:type="string">MaestroInitializeCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="MaestroInitializeCommand" type="Wirecard\ElasticEngine\Gateway\Command\WirecardCommand">
        <arguments>
            <argument name="transactionFactory" xsi:type="object">CreditCardTransactionFactory</argument>
            <argument name="transactionServiceFactory" xsi:type="object">TransactionServiceFactory</argument>
            <argument name="handler" xsi:type="object">Wirecard\ElasticEngine\Gateway\Response\ResponseHandler</argument>
            <argument name="methodConfig" xsi:type="object">WirecardMaestroConfig</argument>
        </arguments>
    </virtualType>

    <!-- Wirecard paymentSDK transaction objects -->
    <virtualType name="PayPalTransactionFactory" type="Wirecard\ElasticEngine\Gateway\Request\PayPalTransactionFactory">
        <arguments>
            <argument name="transaction" xsi:type="object">Wirecard\PaymentSdk\Transaction\PayPalTransaction</argument>
            <argument name="basketFactory" xsi:type="object">BasketFactory</argument>
            <argument name="accountHolderFactory" xsi:type="object">AccountHolderFactory</argument>
            <argument name="methodConfig" xsi:type="object">WirecardPaypalConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="CreditCardTransactionFactory" type="Wirecard\ElasticEngine\Gateway\Request\CreditCardTransactionFactory">
        <arguments>
            <argument name="transaction" xsi:type="object">Wirecard\PaymentSdk\Transaction\CreditCardTransaction</argument>
        </arguments>
    </virtualType>

    <!-- Wirecard paymentSDK objects -->
    <virtualType name="BasketFactory" type="Wirecard\ElasticEngine\Gateway\Request\BasketFactory">
        <arguments>
            <argument name="itemFactory" xsi:type="object">Wirecard\ElasticEngine\Gateway\Request\ItemFactory</argument>
        </arguments>
    </virtualType>

    <virtualType name="AccountHolderFactory" type="Wirecard\ElasticEngine\Gateway\Request\AccountHolderFactory">
        <arguments>
            <argument name="addressFactory" xsi:type="object">Wirecard\ElasticEngine\Gateway\Request\AddressFactory</argument>
        </arguments>
    </virtualType>

    <virtualType name="TransactionServiceFactory" type="Wirecard\ElasticEngine\Gateway\Service\TransactionServiceFactory">
        <arguments>
            <argument name="paymentSdkConfigFactory" xsi:type="object">PaymentSdkConfigFactory</argument>
        </arguments>
    </virtualType>

    <virtualType name="PaymentSdkConfigFactory" type="Wirecard\ElasticEngine\Gateway\Config\PaymentSdkConfigFactory">
        <arguments>
            <argument name="eeConfig" xsi:type="object">WirecardElasticEngineConfig</argument>
            <argument name="methodConfigs" xsi:type="array">
                <item name="paypal" xsi:type="object">WirecardPaypalConfig</item>
                <item name="creditcard" xsi:type="object">WirecardCreditCardConfig</item>
            </argument>
            <argument name="productMetadata" xsi:type="object">Magento\Framework\App\ProductMetadata</argument>
            <argument name="moduleList" xsi:type="object">Magento\Framework\Module\ModuleListInterface</argument>
        </arguments>
    </virtualType>

    <type name="Wirecard\ElasticEngine\Controller\Frontend\Notify">
        <arguments>
            <argument name="transactionServiceFactory" xsi:type="object">TransactionServiceFactory</argument>
        </arguments>
    </type>

    <type name="Wirecard\ElasticEngine\Controller\Frontend\Redirect">
        <arguments>
            <argument name="transactionServiceFactory" xsi:type="object">TransactionServiceFactory</argument>
        </arguments>
    </type>

    <!-- Wirecard ui objects -->
    <type name="Wirecard\ElasticEngine\Model\Ui\ConfigProvider">
        <arguments>
            <argument name="transactionServiceFactory" xsi:type="object">TransactionServiceFactory</argument>
        </arguments>
    </type>
    <type name="Wirecard\ElasticEngine\Block\Checkout\PaymentPageLoader">
        <arguments>
            <argument name="eeConfig" xsi:type="object">WirecardElasticEngineConfig</argument>
        </arguments>
    </type>
</config>
